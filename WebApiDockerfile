FROM mcr.microsoft.com/dotnet/sdk:7.0 AS build-env

WORKDIR /app
EXPOSE 80
EXPOSE 443

COPY ./src/SmartTalk.Api ./build/SmartTalk.Api
COPY ./src/SmartTalk.Core ./build/SmartTalk.Core
COPY ./src/SmartTalk.Messages ./build/SmartTalk.Messages
COPY ./NuGet.Config ./build

RUN dotnet publish build/SmartTalk.Api -c Release -o out

FROM mcr.microsoft.com/dotnet/aspnet:7.0

WORKDIR /app
COPY --from=build-env /app/out .
ENTRYPOINT ["dotnet", "SmartTalk.Api.dll"]